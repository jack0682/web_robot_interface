# π€ MQTT ν† ν”½ μ„¤μ • μ™„μ „ μμ • μ™„λ£

## β οΈ λ¬Έμ  μƒν™©
EMQX λΈλ΅μ»¤μ—μ„ ν† ν”½μ΄ λ³΄μ΄μ§€ μ•λ” μ΄μ λ” **λ°±μ—”λ“ MQTT ν΄λΌμ΄μ–ΈνΈ μ„¤μ •**μ—μ„ ν† ν”½ λ§¤ν•‘μ΄ μλ»λμ–΄ μμ—κΈ° λ•λ¬Έμ…λ‹λ‹¤.

κΈ°μ΅΄ μ„¤μ •μ—μ„λ”:
- `ros2_topic_list` β†’ `'test'` ν† ν”½ κµ¬λ… (β μλ»λ¨)
- `weight_sensor` β†’ `'scale/raw'` ν† ν”½ κµ¬λ… (β μ‹¤μ λ΅λ” μ‚¬μ©λμ§€ μ•μ)

## π”§ μ™„μ „ν• μμ • μ‚¬ν•­

### 1. λ°±μ—”λ“ MQTT ν΄λΌμ΄μ–ΈνΈ ν† ν”½ λ§¤ν•‘ μμ •

**νμΌ**: `mqtt_processor/src/mqttClient.js`

```javascript
// β μ΄μ „ μ„¤μ •
topics: {
  ros2_topic_list: { name: 'test', qos: 1, retain: true },
  weight_sensor: { name: 'scale/raw', qos: 0, retain: false },
  // ...
}

// β… μμ •λ μ„¤μ •  
topics: {
  weight_sensor: { name: 'test', qos: 1, retain: false },  // λ¬΄κ² μ„Όμ„ λ°μ΄ν„°
  ros2_topic_list: { name: 'ros2_topic_list', qos: 1, retain: true },
  // ...
}
```

### 2. λ©”μ‹μ§€ μ²λ¦¬ λ΅μ§ μμ •

```javascript
// β… μ¬λ°”λ¥Έ ν† ν”½ μ²λ¦¬
if (topic === 'test') {
  // π― λ¬΄κ² μ„Όμ„ λ°μ΄ν„° - μ‹¤μ  λ¬΄κ² μ„Όμ„
  parsedMessage = this.parseWeightSensorData(message);
  
} else if (topic === 'ros2_topic_list') {
  // π― ROS2 topic list - λ¨λ“  ν† ν”½μ΄ λ¬¶μ—¬μ„ μ „μ†΅
  parsedMessage = this.parseROS2TopicList(message);
```

### 3. ν”„λ΅ νΈμ—”λ“ ν† ν”½ κµ¬λ… μ„¤μ •λ„ μ΄λ―Έ μ™„λ£

**νμΌλ“¤**: `MqttContext.tsx`, `useMqttData.ts`
- `'test'` ν† ν”½μ„ λ¬΄κ² μ„Όμ„ λ°μ΄ν„°λ΅ μ²λ¦¬ν•λ„λ΅ μ„¤μ • μ™„λ£ β…

## π― ν„μ¬ ν† ν”½ κµ¬μ΅°

| ν† ν”½ μ΄λ¦„ | λ°μ΄ν„° νƒ€μ… | μ„¤λ… | QoS |
|----------|------------|------|-----|
| `test` | λ¬΄κ² μ„Όμ„ λ°μ΄ν„° | ROS2 μ¤μΌ€μΌμ—μ„ λ°ν–‰ν•λ” μ‹¤μ  λ¬΄κ² κ°’ | 1 |
| `ros2_topic_list` | ROS2 ν† ν”½ λ©λ΅ | λ¨λ“  ROS2 ν† ν”½μ΄ λ¬¶μ—¬μ„ μ „μ†΅λλ” λ©”νƒ€λ°μ΄ν„° | 1 |
| `web/target_concentration` | λ†λ„ μ„¤μ • | μ›Ήμ—μ„ μ„¤μ •ν•λ” λ©ν‘ λ†λ„ κ°’ | 1 |
| `robot/control/+` | λ΅λ΄‡ μ μ–΄ | λ΅λ΄‡ μ μ–΄ λ…λ Ή | 2 |
| `system/health` | μ‹μ¤ν… μƒνƒ | μ‹μ¤ν… ν—¬μ¤μ²΄ν¬ μ •λ³΄ | 0 |

## π€ μ‹μ¤ν… μ¬μ‹μ‘ ν•„μ”

μ„¤μ • λ³€κ²½μ‚¬ν•­μ„ μ μ©ν•λ ¤λ©΄ **μ „μ²΄ μ‹μ¤ν…μ„ μ¬μ‹μ‘**ν•΄μ•Ό ν•©λ‹λ‹¤:

```bash
# κΈ°μ΅΄ ν”„λ΅μ„Έμ¤ λ¨λ‘ μΆ…λ£
./start_system.sh --kill

# μ „μ²΄ μ‹μ¤ν… μ¬μ‹μ‘
./start_system.sh
```

## π” ν™•μΈ λ°©λ²•

### 1. EMQX λ€μ‹λ³΄λ“μ—μ„ ν™•μΈ
- ν΄λΌμ΄μ–ΈνΈ μ—°κ²°: `ros2_scale_pub` (λ°ν–‰μ) + μ›Ή λ€μ‹λ³΄λ“ ν΄λΌμ΄μ–ΈνΈ (κµ¬λ…μ)
- κµ¬λ… ν† ν”½: `test`, `ros2_topic_list`, `web/target_concentration`, `robot/control/+`, `system/health`

### 2. μ½μ†” λ΅κ·Έ ν™•μΈ
```bash
# MQTT ν”„λ΅μ„Έμ„ λ΅κ·Έ
tail -f data/logs/system/mqtt_processor.log

# μμƒ λ΅κ·Έ:
# [INFO] π“΅ Subscribed to topic: test (weight_sensor)
# [DEBUG] β–οΈ  Weight sensor data received { value: 3.152 }
```

### 3. μ›Ή λ€μ‹λ³΄λ“ ν™•μΈ
- λΈλΌμ°μ € κ°λ°μλ„κµ¬ μ½μ†”μ—μ„:
```
π“¨ MQTT λ©”μ‹μ§€ μμ‹ : test
β–οΈ λ¬΄κ²μ„Όμ„ λ°μ΄ν„°: 3.152 g
```

## π‰ μ™„λ£!

μ΄μ  λ‹¤μμ΄ λ¨λ‘ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—μµλ‹λ‹¤:

- β… **λ°±μ—”λ“**: `test` ν† ν”½μ„ λ¬΄κ² μ„Όμ„ λ°μ΄ν„°λ΅ κµ¬λ… λ° μ²λ¦¬
- β… **ν”„λ΅ νΈμ—”λ“**: `test` ν† ν”½μ—μ„ λ¬΄κ² μ„Όμ„ λ°μ΄ν„° μμ‹  λ° ν‘μ‹  
- β… **EMQX μ—°κ²°**: μ¬λ°”λ¥Έ ν† ν”½μ„ κµ¬λ…ν•μ—¬ λΈλ΅μ»¤μ—μ„ κµ¬λ…μκ°€ ν‘μ‹λ¨
- β… **μ‹¤μ‹κ°„ λ°μ΄ν„°**: λ¬΄κ² μ„Όμ„ β†’ EMQX β†’ λ°±μ—”λ“ β†’ μ›Ή λ€μ‹λ³΄λ“ νμ΄ν”„λΌμΈ μ™„μ„±

μ‹μ¤ν…μ„ μ¬μ‹μ‘ν•λ©΄ EMQX λ€μ‹λ³΄λ“μ—μ„ μ›Ή λ€μ‹λ³΄λ“ ν΄λΌμ΄μ–ΈνΈκ°€ `test` ν† ν”½μ„ κµ¬λ…ν•λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤!